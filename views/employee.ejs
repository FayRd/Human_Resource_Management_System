<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employee List</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="/style.css">
</head>

<body>
  <main class="main-content">
    <!-- Navbar -->
    <%- include ('partials/navbar.ejs') %>
      <!-- Breadcrumb -->
      <div>
        <nav aria-label="breadcrumb">
          <ol class="px-4 breadcrumb c-pri-bg rounded-bottom">
            <li class="breadcrumb-item"><a class="white-txt" href="/">Home</a></li>
            <li class="breadcrumb-item white-txt" aria-current="page">Employees</li>
          </ol>
        </nav>
      </div>
      <!-- Employee List -->
      <section>
        <div class="container-fluid px-4 my-1">
          <h2 class="mb-3"><svg class="svg-icon" viewBox="0 0 20 20">
              <path
                d="M15.573,11.624c0.568-0.478,0.947-1.219,0.947-2.019c0-1.37-1.108-2.569-2.371-2.569s-2.371,1.2-2.371,2.569c0,0.8,0.379,1.542,0.946,2.019c-0.253,0.089-0.496,0.2-0.728,0.332c-0.743-0.898-1.745-1.573-2.891-1.911c0.877-0.61,1.486-1.666,1.486-2.812c0-1.79-1.479-3.359-3.162-3.359S4.269,5.443,4.269,7.233c0,1.146,0.608,2.202,1.486,2.812c-2.454,0.725-4.252,2.998-4.252,5.685c0,0.218,0.178,0.396,0.395,0.396h16.203c0.218,0,0.396-0.178,0.396-0.396C18.497,13.831,17.273,12.216,15.573,11.624 M12.568,9.605c0-0.822,0.689-1.779,1.581-1.779s1.58,0.957,1.58,1.779s-0.688,1.779-1.58,1.779S12.568,10.427,12.568,9.605 M5.06,7.233c0-1.213,1.014-2.569,2.371-2.569c1.358,0,2.371,1.355,2.371,2.569S8.789,9.802,7.431,9.802C6.073,9.802,5.06,8.447,5.06,7.233 M2.309,15.335c0.202-2.649,2.423-4.742,5.122-4.742s4.921,2.093,5.122,4.742H2.309z M13.346,15.335c-0.067-0.997-0.382-1.928-0.882-2.732c0.502-0.271,1.075-0.429,1.686-0.429c1.828,0,3.338,1.385,3.535,3.161H13.346z">
              </path>
            </svg>Employees</h2>
            <!-- Add Employee -->
             <div style="display: flex; width: 100%; justify-content: space-between;">
                <a href="/AddEmployee" type="button" class="btn btn-dark h-50">Add Employee</a>
                <input type="text" class="form-control mb-3 w-25" id="em-search" onkeyup="filterTable()" placeholder="Search for employee by name">
             </div>
          <table class="table table-striped shadow-sm border border-2" id="myTable">
            <tr>
              <th width="60px">#</th>
              <th width="600px">Name</th>
              <th>Business E-mail</th>
              <th width="300px">Mobile</th>
              <th width="300px">Department</th>
            </tr>
            <% if (employees.length===0) { %>
              <tr>
                <td colspan="6" class="text-center">No Records Found</td>
              </tr>
              <% } %>
                <% for (let i=0; i<employees.length; i++) { %>
                  <tr>
                    <td><%=employees[i].id %></td>
                    <td><a class="link-primary link-underline-opacity-50-hover link-underline-opacity-0"
                        href="/Employee/<%=employees[i].id%>">
                        <%=employees[i].firstName + ' ' + employees[i].lastName %>
                      </a>
                    </td>
                    <td><a class="link-primary link-underline-opacity-50-hover link-underline-opacity-0"
                        href="mailto:<%=employees[i].businessEmail%>">
                        <%=employees[i].businessEmail %>
                      </a></td>
                    <td>+65 <%=employees[i].businessMobile %></td>
                    <td><%=employees[i].name %></td>
                  </tr>
                  <% } %>
          </table>
        </div>
      </section>
  </main>
  <footer>
    <%- include ('partials/footer.ejs') %>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
    <script>
      function filterTable() {
        // Declare variables
        const input = document.getElementById('em-search');
        const table = document.getElementById("myTable");
        const tr = table.getElementsByTagName('tr');

        for (let i = 0; i < tr.length; i++) {
          // Get the text content of the current table cell
          const secondTd = tr[i].querySelector("td:nth-child(2)");
          const a = (secondTd) ? secondTd.querySelector("a") : null;
          const tdText = (a) ? a.textContent : "";
          // Convert the text to uppercase for case-insensitive matching
          const searchQuery = input.value.toUpperCase();

          // Check if the text content of the second table cell contains the search query (case-insensitive)
          if (tdText.toUpperCase().indexOf(searchQuery) > -1) {
            tr[i].style.display = ""; // Display the table row
          } else if (tr[i].getElementsByTagName('th').length > 0) {
            tr[i].style.display = "";
          } else {
            tr[i].style.display = "none"; // Hide the table row
          }
        }
      }

      input.addEventListener("input", filterTable);
    </script>

</body>

</html>